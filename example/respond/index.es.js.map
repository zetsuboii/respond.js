{"version":3,"file":"index.es.js","sources":["../src/globals.js","../src/state.js","../src/components.js","../src/respond.js"],"sourcesContent":["/** Counter for elements */\nlet _elementCounter = 0;\nexport const getElementCounter = () => _elementCounter;\nexport const incrementElementCounter = () => _elementCounter++;\n\n/** Counter for states */\nlet _stateCounter = 0;\nexport const getStateCounter = () => _stateCounter;\nexport const incrementStateCounter = () => _stateCounter++;\n\n/** @type {Record<string, Record<string, any>>} */\nexport const _stateStore = {};\n\n/** @type {Map<string, string[]} subscriptions */\nexport const _stateSubscriptions = new Map();\nexport const subscribeToState = (tag, id) => {\n    _stateSubscriptions.set(tag, [...(_stateSubscriptions.get(tag) ?? []), id]);\n};\n","import {\n    _stateStore,\n    _stateSubscriptions,\n    incrementStateCounter,\n} from \"./globals.js\";\n\nexport function getState(tag) {\n    return _stateStore[tag];\n}\n\nfunction notifySubscribers(tag) {\n    const stateEvent = new CustomEvent(`state::${tag}`, {});\n\n    const tagSubscriptions = _stateSubscriptions.get(tag) ?? [];\n    for (const elemId of tagSubscriptions) {\n        const element = document.getElementById(elemId);\n        if (element) element.dispatchEvent(stateEvent);\n    }\n}\n\n/**\n * Wraps array in a proxy so that .push operation is reflected\n * For a complete implementation other mutating array operations has to be completed\n */\nfunction wrapArray(tag, array) {\n    return new Proxy(array, {\n        get: (target, key) => {\n            if (key === \"push\") {\n                return (...args) => {\n                    target[key](...args);\n                    notifySubscribers(tag);\n                };\n            }\n\n            return target[key];\n        },\n    });\n}\n\n/** Wrap the state in order to catch push events */\nfunction wrapInitialState(tag, initial) {\n    const state = {};\n\n    // For every key in the initial state; if item is an array, create a proxy\n    // and replace it inside the state. This proxy will catch push events and\n    // notify subscribers.\n    for (const key in initial) {\n        if (Array.isArray(initial[key])) {\n            state[key] = wrapArray(tag, initial[key]);\n\n            for (let i = 0; i < initial[key].length; i++) {\n                if (typeof initial[key][i] === \"object\") {\n                    initial[key][i] = wrapInitialState(tag, initial[key][i]);\n                }\n            }\n        } else {\n            state[key] = initial[key];\n        }\n    }\n\n    return state;\n}\n\nexport function createState(initial) {\n    const tag = `state-${incrementStateCounter()}`;\n    const _state = wrapInitialState(tag, initial);\n\n    _stateStore[tag] = new Proxy(_state, {\n        get: (target, key) => {\n            return target[key];\n        },\n        set: (target, key, value) => {\n            if (Array.isArray(value)) {\n                target[key] = wrapArray(tag, value);\n            } else {\n                target[key] = value;\n            }\n            notifySubscribers(tag);\n            return true;\n        },\n    });\n\n    return tag;\n}\n\nexport const ReactiveSymbol = Symbol(\"Reactive\");\nexport const ReactiveChildren = Symbol(\"ReactiveChildren\");\n\nexport const reactive = (tag, getValue) => ({\n    [ReactiveSymbol]: true,\n    tag,\n    getValue,\n});\n\nexport const reactiveChildren = (tag, getChildren) => ({\n    [ReactiveChildren]: true,\n    tag,\n    getChildren,\n});\n","import {\n    _stateSubscriptions,\n    incrementElementCounter,\n    subscribeToState,\n} from \"./globals.js\";\nimport { createComponent } from \"./respond.js\";\nimport { ReactiveChildren, ReactiveSymbol } from \"./state.js\";\nimport { getState } from \"./state.js\";\n\n/**\n * Converts CSS object to string\n * @param {CSSStyleDeclaration} style\n * @returns {string}\n */\nconst getStyle = (style) => {\n    const styleString = [];\n\n    const camelToKebab = (str) =>\n        str.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g, \"$1-$2\").toLowerCase();\n\n    for (let key in style) {\n        const fmt = camelToKebab(key);\n        styleString.push(`${fmt}: ${style[key]};`);\n    }\n    return styleString.join(\" \");\n};\n\n/**\n * @param {string} name\n * @param {HTMLElement} props\n * @param {HTMLElement[]} children\n * @returns {[HTMLElement, HTMLElement[]]}\n */\nfunction generateComponent(name, props, children) {\n    const element = document.createElement(name);\n    element.id = props.id ?? `${name}-${incrementElementCounter()}`;\n\n    // Allow usages like:\n    // * element(): translates to element({}, undefined)\n    // * element(props): translates to element(props, undefined)\n    // * element(children): translates to element({}, children)\n    // Undefined children are fine as they are ignored\n    if (children == undefined) {\n        if (Array.isArray(props) || props[ReactiveChildren]) {\n            children = props;\n            props = {};\n        } else if (props == undefined) {\n            props = {};\n        }\n    }\n\n    for (const key in props) {\n        if (props[key][ReactiveSymbol]) {\n            const { tag, getValue } = props[key];\n\n            element[key] = getValue(getState(tag));\n            element.addEventListener(`state::${tag}`, () => {\n                element[key] = getValue(getState(tag));\n            });\n            subscribeToState(tag, element.id);\n            continue;\n        }\n\n        if (key === \"style\" && typeof props[key] === \"object\") {\n            element[key] = getStyle(props[key]);\n            continue;\n        }\n\n        element[key] = props[key];\n    }\n\n    if (!Array.isArray(children) && children?.[ReactiveChildren]) {\n        const { tag, getChildren } = children;\n\n        children = getChildren(getState(tag));\n        element.addEventListener(`state::${tag}`, () => {\n            element.replaceChildren(\n                ...getChildren(getState(tag)).map(createComponent)\n            );\n        });\n        subscribeToState(tag, element.id);\n    }\n\n    return [element, children];\n}\n\n/** @param {HTMLButtonElement} props @param {HTMLElement[]} children */\nexport function button(props, children) {\n    return generateComponent(\"button\", props, children);\n}\n\n/** @param {HTMLParagraphElement} props @param {HTMLElement[]} children */\nexport function p(props, children) {\n    return generateComponent(\"p\", props, children);\n}\n\n/** @param {HTMLInputElement} props @param {HTMLElement[]} children */\nexport function input(props, children) {\n    return generateComponent(\"input\", props, children);\n}\n\n/** @param {HTMLDivElement} props @param {HTMLElement[]} children */\nexport function div(props, children) {\n    return generateComponent(\"div\", props, children);\n}\n\n/** @param {HTMLHeadingElement} props @param {HTMLElement[]} children */\nexport function h1(props, children) {\n    return generateComponent(\"h1\", props, children);\n}\n\n/** @param {HTMLHeadingElement} props @param {HTMLElement[]} children */\nexport function h2(props, children) {\n    return generateComponent(\"h2\", props, children);\n}\n\n/** @param {HTMLHeadingElement} props @param {HTMLElement[]} children */\nexport function h3(props, children) {\n    return generateComponent(\"h3\", props, children);\n}\n\n/** @param {HTMLHeadingElement} props @param {HTMLElement[]} children */\nexport function h4(props, children) {\n    return generateComponent(\"h4\", props, children);\n}\n\n","export * from \"./components.js\";\nexport * from \"./state.js\";\n\nexport const createComponent = (component) => {\n    const [element, children] = component;\n    if (children == undefined) return element;\n\n    for (const child of children) {\n        element.appendChild(createComponent(child));\n    }\n    return element;\n};\n\nexport function createApp(root, layout) {\n    const rootNode = document.querySelector(root);\n    if (rootNode == undefined) return;\n\n    for (const component of layout) {\n        rootNode.appendChild(createComponent(component));\n    }\n}\n"],"names":["_elementCounter","incrementElementCounter","_stateCounter","incrementStateCounter","_stateStore","_stateSubscriptions","subscribeToState","tag","id","getState","notifySubscribers","stateEvent","tagSubscriptions","elemId","element","wrapArray","array","target","key","args","wrapInitialState","initial","state","i","createState","_state","value","ReactiveSymbol","ReactiveChildren","reactive","getValue","reactiveChildren","getChildren","getStyle","style","styleString","camelToKebab","str","fmt","generateComponent","name","props","children","createComponent","button","p","input","div","h1","h2","h3","h4","component","child","createApp","root","layout","rootNode"],"mappings":"AACA,IAAIA,IAAkB;AAEf,MAAMC,IAA0B,MAAMD;AAG7C,IAAIE,IAAgB;AAEb,MAAMC,IAAwB,MAAMD,KAG9BE,IAAc,CAAA,GAGdC,IAAsB,oBAAI,OAC1BC,IAAmB,CAACC,GAAKC,MAAO;AACzC,EAAAH,EAAoB,IAAIE,GAAK,CAAC,GAAIF,EAAoB,IAAIE,CAAG,KAAK,CAAA,GAAKC,CAAE,CAAC;AAC9E;ACXO,SAASC,EAASF,GAAK;AAC1B,SAAOH,EAAYG,CAAG;AAC1B;AAEA,SAASG,EAAkBH,GAAK;AAC5B,QAAMI,IAAa,IAAI,YAAY,UAAUJ,CAAG,IAAI,CAAA,CAAE,GAEhDK,IAAmBP,EAAoB,IAAIE,CAAG,KAAK,CAAA;AACzD,aAAWM,KAAUD,GAAkB;AACnC,UAAME,IAAU,SAAS,eAAeD,CAAM;AAC9C,IAAIC,KAASA,EAAQ,cAAcH,CAAU;AAAA,EAChD;AACL;AAMA,SAASI,EAAUR,GAAKS,GAAO;AAC3B,SAAO,IAAI,MAAMA,GAAO;AAAA,IACpB,KAAK,CAACC,GAAQC,MACNA,MAAQ,SACD,IAAIC,MAAS;AAChB,MAAAF,EAAOC,CAAG,EAAE,GAAGC,CAAI,GACnBT,EAAkBH,CAAG;AAAA,IACzC,IAGmBU,EAAOC,CAAG;AAAA,EAE7B,CAAK;AACL;AAGA,SAASE,EAAiBb,GAAKc,GAAS;AACpC,QAAMC,IAAQ,CAAA;AAKd,aAAWJ,KAAOG;AACd,QAAI,MAAM,QAAQA,EAAQH,CAAG,CAAC,GAAG;AAC7B,MAAAI,EAAMJ,CAAG,IAAIH,EAAUR,GAAKc,EAAQH,CAAG,CAAC;AAExC,eAASK,IAAI,GAAGA,IAAIF,EAAQH,CAAG,EAAE,QAAQK;AACrC,QAAI,OAAOF,EAAQH,CAAG,EAAEK,CAAC,KAAM,aAC3BF,EAAQH,CAAG,EAAEK,CAAC,IAAIH,EAAiBb,GAAKc,EAAQH,CAAG,EAAEK,CAAC,CAAC;AAAA,IAG3E;AACY,MAAAD,EAAMJ,CAAG,IAAIG,EAAQH,CAAG;AAIhC,SAAOI;AACX;AAEO,SAASE,EAAYH,GAAS;AACjC,QAAMd,IAAM,SAASJ,EAAqB,CAAE,IACtCsB,IAASL,EAAiBb,GAAKc,CAAO;AAE5C,SAAAjB,EAAYG,CAAG,IAAI,IAAI,MAAMkB,GAAQ;AAAA,IACjC,KAAK,CAACR,GAAQC,MACHD,EAAOC,CAAG;AAAA,IAErB,KAAK,CAACD,GAAQC,GAAKQ,OACX,MAAM,QAAQA,CAAK,IACnBT,EAAOC,CAAG,IAAIH,EAAUR,GAAKmB,CAAK,IAElCT,EAAOC,CAAG,IAAIQ,GAElBhB,EAAkBH,CAAG,GACd;AAAA,EAEnB,CAAK,GAEMA;AACX;AAEY,MAACoB,IAAiB,OAAO,UAAU,GAClCC,IAAmB,OAAO,kBAAkB,GAE5CC,IAAW,CAACtB,GAAKuB,OAAc;AAAA,EACxC,CAACH,CAAc,GAAG;AAAA,EAClB,KAAApB;AAAA,EACA,UAAAuB;AACJ,IAEaC,IAAmB,CAACxB,GAAKyB,OAAiB;AAAA,EACnD,CAACJ,CAAgB,GAAG;AAAA,EACpB,KAAArB;AAAA,EACA,aAAAyB;AACJ,ICpFMC,IAAW,CAACC,MAAU;AACxB,QAAMC,IAAc,CAAA,GAEdC,IAAe,CAACC,MAClBA,EAAI,QAAQ,gCAAgC,OAAO,EAAE,YAAW;AAEpE,WAASnB,KAAOgB,GAAO;AACnB,UAAMI,IAAMF,EAAalB,CAAG;AAC5B,IAAAiB,EAAY,KAAK,GAAGG,CAAG,KAAKJ,EAAMhB,CAAG,CAAC,GAAG;AAAA,EAC5C;AACD,SAAOiB,EAAY,KAAK,GAAG;AAC/B;AAQA,SAASI,EAAkBC,GAAMC,GAAOC,GAAU;AAC9C,QAAM5B,IAAU,SAAS,cAAc0B,CAAI;AAC3C,EAAA1B,EAAQ,KAAK2B,EAAM,MAAM,GAAGD,CAAI,IAAIvC,EAAyB,CAAA,IAOzDyC,KAAY,SACR,MAAM,QAAQD,CAAK,KAAKA,EAAMb,CAAgB,KAC9Cc,IAAWD,GACXA,IAAQ,CAAA,KACDA,KAAS,SAChBA,IAAQ,CAAA;AAIhB,aAAWvB,KAAOuB,GAAO;AACrB,QAAIA,EAAMvB,CAAG,EAAES,CAAc,GAAG;AAC5B,YAAM,EAAE,KAAApB,GAAK,UAAAuB,EAAU,IAAGW,EAAMvB,CAAG;AAEnC,MAAAJ,EAAQI,CAAG,IAAIY,EAASrB,EAASF,CAAG,CAAC,GACrCO,EAAQ,iBAAiB,UAAUP,CAAG,IAAI,MAAM;AAC5C,QAAAO,EAAQI,CAAG,IAAIY,EAASrB,EAASF,CAAG,CAAC;AAAA,MACrD,CAAa,GACDD,EAAiBC,GAAKO,EAAQ,EAAE;AAChC;AAAA,IACH;AAED,QAAII,MAAQ,WAAW,OAAOuB,EAAMvB,CAAG,KAAM,UAAU;AACnD,MAAAJ,EAAQI,CAAG,IAAIe,EAASQ,EAAMvB,CAAG,CAAC;AAClC;AAAA,IACH;AAED,IAAAJ,EAAQI,CAAG,IAAIuB,EAAMvB,CAAG;AAAA,EAC3B;AAED,MAAI,CAAC,MAAM,QAAQwB,CAAQ,KAAKA,IAAWd,CAAgB,GAAG;AAC1D,UAAM,EAAE,KAAArB,GAAK,aAAAyB,EAAa,IAAGU;AAE7B,IAAAA,IAAWV,EAAYvB,EAASF,CAAG,CAAC,GACpCO,EAAQ,iBAAiB,UAAUP,CAAG,IAAI,MAAM;AAC5C,MAAAO,EAAQ;AAAA,QACJ,GAAGkB,EAAYvB,EAASF,CAAG,CAAC,EAAE,IAAIoC,CAAe;AAAA,MACjE;AAAA,IACA,CAAS,GACDrC,EAAiBC,GAAKO,EAAQ,EAAE;AAAA,EACnC;AAED,SAAO,CAACA,GAAS4B,CAAQ;AAC7B;AAGO,SAASE,EAAOH,GAAOC,GAAU;AACpC,SAAOH,EAAkB,UAAUE,GAAOC,CAAQ;AACtD;AAGO,SAASG,EAAEJ,GAAOC,GAAU;AAC/B,SAAOH,EAAkB,KAAKE,GAAOC,CAAQ;AACjD;AAGO,SAASI,EAAML,GAAOC,GAAU;AACnC,SAAOH,EAAkB,SAASE,GAAOC,CAAQ;AACrD;AAGO,SAASK,EAAIN,GAAOC,GAAU;AACjC,SAAOH,EAAkB,OAAOE,GAAOC,CAAQ;AACnD;AAGO,SAASM,EAAGP,GAAOC,GAAU;AAChC,SAAOH,EAAkB,MAAME,GAAOC,CAAQ;AAClD;AAGO,SAASO,EAAGR,GAAOC,GAAU;AAChC,SAAOH,EAAkB,MAAME,GAAOC,CAAQ;AAClD;AAGO,SAASQ,EAAGT,GAAOC,GAAU;AAChC,SAAOH,EAAkB,MAAME,GAAOC,CAAQ;AAClD;AAGO,SAASS,EAAGV,GAAOC,GAAU;AAChC,SAAOH,EAAkB,MAAME,GAAOC,CAAQ;AAClD;ACzHY,MAACC,IAAkB,CAACS,MAAc;AAC1C,QAAM,CAACtC,GAAS4B,CAAQ,IAAIU;AAC5B,MAAIV,KAAY;AAAW,WAAO5B;AAElC,aAAWuC,KAASX;AAChB,IAAA5B,EAAQ,YAAY6B,EAAgBU,CAAK,CAAC;AAE9C,SAAOvC;AACX;AAEO,SAASwC,EAAUC,GAAMC,GAAQ;AACpC,QAAMC,IAAW,SAAS,cAAcF,CAAI;AAC5C,MAAIE,KAAY;AAEhB,eAAWL,KAAaI;AACpB,MAAAC,EAAS,YAAYd,EAAgBS,CAAS,CAAC;AAEvD;"}