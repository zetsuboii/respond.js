{"version":3,"file":"index.umd.js","sources":["../src/globals.js","../src/state.js","../src/components.js","../src/respond.js"],"sourcesContent":["/** Counter for elements */\nlet _elementCounter = 0;\nexport const getElementCounter = () => _elementCounter;\nexport const incrementElementCounter = () => _elementCounter++;\n\n/** Counter for states */\nlet _stateCounter = 0;\nexport const getStateCounter = () => _stateCounter;\nexport const incrementStateCounter = () => _stateCounter++;\n\n/** @type {Record<string, Record<string, any>>} */\nexport const _stateStore = {};\n\n/** @type {Map<string, string[]} subscriptions */\nexport const _stateSubscriptions = new Map();\nexport const subscribeToState = (tag, id) => {\n    _stateSubscriptions.set(tag, [...(_stateSubscriptions.get(tag) ?? []), id]);\n};\n","import {\n    _stateStore,\n    _stateSubscriptions,\n    incrementStateCounter,\n} from \"./globals.js\";\n\nexport function getState(tag) {\n    return _stateStore[tag];\n}\n\nfunction notifySubscribers(tag) {\n    const stateEvent = new CustomEvent(`state::${tag}`, {});\n\n    const tagSubscriptions = _stateSubscriptions.get(tag) ?? [];\n    for (const elemId of tagSubscriptions) {\n        const element = document.getElementById(elemId);\n        if (element) element.dispatchEvent(stateEvent);\n    }\n}\n\n/**\n * Wraps array in a proxy so that .push operation is reflected\n * For a complete implementation other mutating array operations has to be completed\n */\nfunction wrapArray(tag, array) {\n    return new Proxy(array, {\n        get: (target, key) => {\n            if (key === \"push\") {\n                return (...args) => {\n                    target[key](...args);\n                    notifySubscribers(tag);\n                };\n            }\n\n            return target[key];\n        },\n    });\n}\n\n/** Wrap the state in order to catch push events */\nfunction wrapInitialState(tag, initial) {\n    const state = {};\n\n    // For every key in the initial state; if item is an array, create a proxy\n    // and replace it inside the state. This proxy will catch push events and\n    // notify subscribers.\n    for (const key in initial) {\n        if (Array.isArray(initial[key])) {\n            state[key] = wrapArray(tag, initial[key]);\n\n            for (let i = 0; i < initial[key].length; i++) {\n                if (typeof initial[key][i] === \"object\") {\n                    initial[key][i] = wrapInitialState(tag, initial[key][i]);\n                }\n            }\n        } else {\n            state[key] = initial[key];\n        }\n    }\n\n    return state;\n}\n\nexport function createState(initial) {\n    const tag = `state-${incrementStateCounter()}`;\n    const _state = wrapInitialState(tag, initial);\n\n    _stateStore[tag] = new Proxy(_state, {\n        get: (target, key) => {\n            return target[key];\n        },\n        set: (target, key, value) => {\n            if (Array.isArray(value)) {\n                target[key] = wrapArray(tag, value);\n            } else {\n                target[key] = value;\n            }\n            notifySubscribers(tag);\n            return true;\n        },\n    });\n\n    return tag;\n}\n\nexport const ReactiveSymbol = Symbol(\"Reactive\");\nexport const ReactiveChildren = Symbol(\"ReactiveChildren\");\n\nexport const reactive = (tag, getValue) => ({\n    [ReactiveSymbol]: true,\n    tag,\n    getValue,\n});\n\nexport const reactiveChildren = (tag, getChildren) => ({\n    [ReactiveChildren]: true,\n    tag,\n    getChildren,\n});\n","import {\n    _stateSubscriptions,\n    incrementElementCounter,\n    subscribeToState,\n} from \"./globals.js\";\nimport { createComponent } from \"./respond.js\";\nimport { ReactiveChildren, ReactiveSymbol } from \"./state.js\";\nimport { getState } from \"./state.js\";\n\n/**\n * Converts CSS object to string\n * @param {CSSStyleDeclaration} style\n * @returns {string}\n */\nconst getStyle = (style) => {\n    const styleString = [];\n\n    const camelToKebab = (str) =>\n        str.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g, \"$1-$2\").toLowerCase();\n\n    for (let key in style) {\n        const fmt = camelToKebab(key);\n        styleString.push(`${fmt}: ${style[key]};`);\n    }\n    return styleString.join(\" \");\n};\n\n/**\n * @param {string} name\n * @param {HTMLElement} props\n * @param {HTMLElement[]} children\n * @returns {[HTMLElement, HTMLElement[]]}\n */\nfunction generateComponent(name, props, children) {\n    const element = document.createElement(name);\n    element.id = props.id ?? `${name}-${incrementElementCounter()}`;\n\n    // Allow usages like:\n    // * element(): translates to element({}, undefined)\n    // * element(props): translates to element(props, undefined)\n    // * element(children): translates to element({}, children)\n    // Undefined children are fine as they are ignored\n    if (children == undefined) {\n        if (Array.isArray(props) || props[ReactiveChildren]) {\n            children = props;\n            props = {};\n        } else if (props == undefined) {\n            props = {};\n        }\n    }\n\n    for (const key in props) {\n        if (props[key][ReactiveSymbol]) {\n            const { tag, getValue } = props[key];\n\n            element[key] = getValue(getState(tag));\n            element.addEventListener(`state::${tag}`, () => {\n                element[key] = getValue(getState(tag));\n            });\n            subscribeToState(tag, element.id);\n            continue;\n        }\n\n        if (key === \"style\" && typeof props[key] === \"object\") {\n            element[key] = getStyle(props[key]);\n            continue;\n        }\n\n        element[key] = props[key];\n    }\n\n    if (!Array.isArray(children) && children?.[ReactiveChildren]) {\n        const { tag, getChildren } = children;\n\n        children = getChildren(getState(tag));\n        element.addEventListener(`state::${tag}`, () => {\n            element.replaceChildren(\n                ...getChildren(getState(tag)).map(createComponent)\n            );\n        });\n        subscribeToState(tag, element.id);\n    }\n\n    return [element, children];\n}\n\n/** @param {HTMLButtonElement} props @param {HTMLElement[]} children */\nexport function button(props, children) {\n    return generateComponent(\"button\", props, children);\n}\n\n/** @param {HTMLParagraphElement} props @param {HTMLElement[]} children */\nexport function p(props, children) {\n    return generateComponent(\"p\", props, children);\n}\n\n/** @param {HTMLInputElement} props @param {HTMLElement[]} children */\nexport function input(props, children) {\n    return generateComponent(\"input\", props, children);\n}\n\n/** @param {HTMLDivElement} props @param {HTMLElement[]} children */\nexport function div(props, children) {\n    return generateComponent(\"div\", props, children);\n}\n\n/** @param {HTMLHeadingElement} props @param {HTMLElement[]} children */\nexport function h1(props, children) {\n    return generateComponent(\"h1\", props, children);\n}\n\n/** @param {HTMLHeadingElement} props @param {HTMLElement[]} children */\nexport function h2(props, children) {\n    return generateComponent(\"h2\", props, children);\n}\n\n/** @param {HTMLHeadingElement} props @param {HTMLElement[]} children */\nexport function h3(props, children) {\n    return generateComponent(\"h3\", props, children);\n}\n\n/** @param {HTMLHeadingElement} props @param {HTMLElement[]} children */\nexport function h4(props, children) {\n    return generateComponent(\"h4\", props, children);\n}\n\n","export * from \"./components.js\";\nexport * from \"./state.js\";\n\nexport const createComponent = (component) => {\n    const [element, children] = component;\n    if (children == undefined) return element;\n\n    for (const child of children) {\n        element.appendChild(createComponent(child));\n    }\n    return element;\n};\n\nexport function createApp(root, layout) {\n    const rootNode = document.querySelector(root);\n    if (rootNode == undefined) return;\n\n    for (const component of layout) {\n        rootNode.appendChild(createComponent(component));\n    }\n}\n"],"names":["_elementCounter","incrementElementCounter","_stateCounter","incrementStateCounter","_stateStore","_stateSubscriptions","subscribeToState","tag","id","getState","notifySubscribers","stateEvent","tagSubscriptions","elemId","element","wrapArray","array","target","key","args","wrapInitialState","initial","state","i","createState","_state","value","ReactiveSymbol","ReactiveChildren","reactive","getValue","reactiveChildren","getChildren","getStyle","style","styleString","camelToKebab","str","fmt","generateComponent","name","props","children","createComponent","button","p","input","div","h1","h2","h3","h4","component","child","createApp","root","layout","rootNode"],"mappings":"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"}